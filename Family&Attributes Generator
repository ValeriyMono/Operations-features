<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CSV –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ñ –ê—Ç—Ä–∏–±—É—Ç–∏</title>
  <style>
    :root {
      --bg-primary: #121212;
      --bg-surface: #1e1e1e;
      --bg-elevated: #2b2b2b;
      --bg-input: #333;
      --border-color: #444;
      --text-primary: #ffffff;
      --text-secondary: #aaaaaa;
      --accent: #03dac6;
      --accent-hover: #01c4af;
      --accent-dark: #018786;
      --error: #ff4d4d;
      --success: #90ee90;
      --transition: all 0.3s ease;
      --shadow: 0 4px 20px rgba(0,0,0,0.4);
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.75rem;
      --spacing-md: 1.5rem;
      --spacing-lg: 2.5rem;
      --spacing-xl: 3rem;
      --border-radius: 8px;
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      overflow-x: hidden;
    }
    
    h1 {
      text-align: center;
      margin-bottom: var(--spacing-lg);
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    
    h3 {
      margin-bottom: var(--spacing-md);
      font-weight: 500;
    }
    
    /* Layout & Containers */
    .container {
      background-color: var(--bg-surface);
      padding: var(--spacing-xl);
      margin: var(--spacing-xl) auto;
      border-radius: var(--border-radius);
      max-width: 800px;
      width: 95%;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    #tab2 .container {
      max-width: 1400px;
    }
    
    .row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
      gap: var(--spacing-sm);
    }
    
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--border-color);
      background-color: var(--bg-surface);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .tab {
      padding: var(--spacing-md) var(--spacing-lg);
      cursor: pointer;
      position: relative;
      transition: var(--transition);
      user-select: none;
    }
    
    .tab:hover {
      background-color: var(--bg-elevated);
    }
    
    .tab.active {
      font-weight: 600;
      color: var(--accent);
    }
    
    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 4px;
      background-color: var(--accent);
      border-radius: 4px 4px 0 0;
      transition: var(--transition);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease-in-out;
    }
    
    .tab-content.active {
      display: block;
    }
    
    /* Form Elements */
    label {
      display: block;
      margin: var(--spacing-sm) 0 var(--spacing-xs);
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    input[type="text"], 
    textarea, 
    select {
      width: 100%;
      padding: 0.65rem;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      margin-bottom: var(--spacing-sm);
      font-size: 1rem;
      background-color: var(--bg-input);
      color: var(--text-primary);
      resize: none;
      overflow: hidden;
      transition: var(--transition);
    }
    
    input[type="text"]:focus, 
    textarea:focus, 
    select:focus {
      border-color: var(--accent);
      outline: none;
      box-shadow: 0 0 0 1px var(--accent-dark);
    }
    
    input[type="text"].invalid {
      border: 2px solid var(--error);
      background-color: rgba(255, 77, 77, 0.1);
    }
    
    /* Buttons */
    .button, 
    .nav-btn, 
    .add-btn, 
    .clear-btn, 
    .del-btn, 
    .file-btn {
      background-color: var(--accent);
      color: #000;
      font-weight: 600;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      margin: var(--spacing-xs) var(--spacing-sm) var(--spacing-xs) 0;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }
    
    .button:hover, 
    .add-btn:hover, 
    .nav-btn:hover, 
    .clear-btn:hover, 
    .del-btn:hover, 
    .file-btn:hover {
      background-color: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .button:active, 
    .add-btn:active, 
    .nav-btn:active, 
    .clear-btn:active, 
    .del-btn:active, 
    .file-btn:active {
      transform: translateY(0);
      box-shadow: none;
    }
    
    .del-btn {
      background-color: #e53935;
    }
    
    .del-btn:hover {
      background-color: #c62828;
    }
    
    .file-btn {
      padding: 0.5rem 0.8rem;
      font-size: 0.9rem;
      display: inline-block;
    }
    
    button:disabled, 
    input:disabled, 
    textarea:disabled, 
    select:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
      opacity: 0.6;
      transform: none !important;
      box-shadow: none !important;
    }
    
    /* Tables & Data Display */
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--bg-elevated);
      margin-top: var(--spacing-md);
      border-radius: var(--border-radius);
      overflow: hidden;
    }
    
    th, td {
      border: 1px solid var(--border-color);
      padding: 8px 12px;
      text-align: left;
    }
    
    th {
      background-color: var(--bg-surface);
      font-weight: 500;
    }
    
    #log {
      text-align: center;
      color: var(--success);
      margin-top: var(--spacing-md);
      font-weight: 500;
      min-height: 24px;
    }
    
    #attrLog {
      text-align: center;
      color: var(--success);
      margin-top: var(--spacing-md);
      font-weight: 500;
      min-height: 24px;
    }
    
    #codeError, 
    .attrCodeError {
      color: var(--error);
      font-size: 0.9rem;
      margin-bottom: var(--spacing-sm);
      display: none;
      transition: var(--transition);
    }
    
    #previewContainer {
      display: none;
      margin-top: var(--spacing-md);
      border: 1px solid var(--border-color);
      padding: var(--spacing-md);
      border-radius: var(--border-radius);
      background-color: var(--bg-elevated);
      animation: slideDown 0.3s ease-out;
    }
    
    #previewContainer table {
      table-layout: fixed;
      width: 100%;
    }
    
    #previewContainer th,
    #previewContainer td {
      overflow-wrap: break-word;
      word-wrap: break-word;
      white-space: normal;
      vertical-align: top;
    }
    
    /* File Upload */
    .file-upload-wrapper {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }
    
    #fileStatus {
      transition: var(--transition);
      font-size: 0.9rem;
    }
    
    /* Attribute Generator Specific */
    .attr-generator-row {
      display: flex;
      gap: var(--spacing-md);
      flex-wrap: nowrap;
      align-items: center;
      margin-bottom: var(--spacing-md);
      box-sizing: border-box;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--spacing-md);
      background-color: var(--bg-elevated);
      transition: var(--transition);
      animation: fadeIn 0.3s ease-out;
    }
    
    .attr-generator-row:hover {
      border-color: var(--accent-dark);
    }
    
    .attr-field {
      display: flex;
      flex-direction: column;
      flex: 1 1 0;
    }
    
    .attr-field input,
    .attr-field select {
      padding: 0.5rem 0.75rem;
    }
    
    .attr-code-wrapper {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .convert-btn {
      padding: 0.15rem 0.35rem;
      font-size: 1.2rem;
      height: 37px;
      min-width: 37px;
      line-height: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      border-radius: var(--border-radius);
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideDown {
      from { 
        transform: translateY(-10px);
        opacity: 0;
      }
      to { 
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes highlight {
      0% { background-color: var(--bg-elevated); }
      50% { background-color: rgba(3, 218, 198, 0.2); }
      100% { background-color: var(--bg-elevated); }
    }
    
    .highlight {
      animation: highlight 1s ease-in-out;
    }
    
    #catIndicator {
      background-color: var(--bg-elevated);
      padding: 0.4rem 0.8rem;
      border-radius: var(--border-radius);
      font-weight: 500;
      display: inline-block;
    }
    
    .actions-container {
      display: flex;
      justify-content: space-between;
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--border-color);
      padding-top: var(--spacing-md);
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .attr-generator-row {
        flex-wrap: wrap;
      }
      
      .attr-field {
        width: 48%;
        min-width: 200px;
        flex: 1 1 48%;
      }
    }
    
    @media (max-width: 768px) {
      .container {
        padding: var(--spacing-md);
        margin: var(--spacing-md) auto;
      }
      
      .attr-field {
        width: 100%;
        flex: 1 1 100%;
      }
    }
    
    @media (max-width: 600px) {
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .attr-generator-row {
        flex-direction: column;
      }
      
      .attr-field {
        width: 100%;
      }
      
      .button, .nav-btn, .add-btn, .clear-btn, .del-btn, .file-btn {
        width: 100%;
        margin-right: 0;
      }
    }
    
    #attrExportBtn,
    #attrClearBtn {
      margin-top: var(--spacing-md);
    }
    
    .attr-row-index {
      position: absolute;
      top: -10px;
      left: 10px;
      background-color: var(--accent);
      color: #000;
      font-weight: bold;
      font-size: 0.8rem;
      padding: 0.2rem 0.5rem;
      border-radius: var(--border-radius);
    }
  </style>
</head>
<body>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  <div class="tabs">
    <div class="tab active" data-tab="tab1">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ñ–µ–º—ñ–ª—ñ</div>
    <div class="tab" data-tab="tab2">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∞—Ç—Ä–∏–±—É—Ç—ñ–≤</div>
  </div>

  <!-- –í–º—ñ—Å—Ç –≤–∫–ª–∞–¥–∫–∏ 1 -->
  <div id="tab1" class="tab-content active">
    <div class="container">
      <h1>Family Generator</h1>

      <div class="file-upload-wrapper">
        <label for="attributeFile" class="file-btn">üìÅ –û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ (.csv)</label>
        <span id="fileStatus">üõë –§–∞–π–ª –Ω–µ –¥–æ–¥–∞–Ω–æ</span>
      </div>
      <input type="file" id="attributeFile" accept=".csv" style="display:none"/>

      <div class="row">
        <button class="nav-btn dependent" onclick="prevCategory()" disabled>‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
        <span id="catIndicator">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è 1 / 1</span>
        <button class="nav-btn dependent" onclick="nextCategory()" disabled>–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è</button>
      </div>

      <label>–ö–æ–¥ —Ñ–µ–º—ñ–ª—ñ</label>
      <input type="text" id="codeInput" placeholder="–í–≤–µ–¥—ñ—Ç—å code" oninput="validateCode()" disabled class="dependent" />
      <div id="codeError">‚ùå –õ–∏—à–µ –ª–∞—Ç–∏–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏, –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è.</div>
      <button class="button dependent" type="button" onclick="convertCode()" disabled>–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>

      <label>–ù–∞–∑–≤–∞ —Ñ–µ–º—ñ–ª—ñ</label>
      <input type="text" id="labelInput" placeholder="–í–≤–µ–¥—ñ—Ç—å label-uk_UA" disabled class="dependent" />

      <label>–ê—Ç—Ä–∏–±—É—Ç–∏ (–≤ —Å—Ç–æ–≤–ø—á–∏–∫):</label>
      <textarea id="attrsInput" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥:&#10;–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ&#10;–¢–∏–ø" disabled class="dependent"></textarea>

      <div class="row">
        <button class="add-btn dependent" onclick="addCategory()" disabled>‚ûï –î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</button>
        <button class="del-btn dependent" onclick="deleteCurrentCategory()" disabled>üóë –í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é</button>
      </div>

      <div class="row">
        <button class="button dependent" onclick="generateCSV()" disabled>üì• –ó–±–µ—Ä–µ–≥—Ç–∏ CSV</button>
        <button class="clear-btn dependent" onclick="clearAll()" disabled>üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
        <button class="button dependent" onclick="clearFields()" disabled>üóë –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª—è</button>
        <button class="button dependent" type="button" onclick="togglePreview()" disabled>üîç –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</button>
      </div>

      <div id="log"></div>

      <div id="previewContainer">
        <h3>üîç –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ CSV:</h3>
        <div id="previewBox">–ù–∞—Ä–∞–∑—ñ –ø–æ—Ä–æ–∂–Ω—å–æ...</div>
      </div>
    </div>
  </div>

  <!-- –í–º—ñ—Å—Ç –≤–∫–ª–∞–¥–∫–∏ 2 -->
  <div id="tab2" class="tab-content">
    <div class="container">
      <h1>Attribute Generator</h1>

      <button type="button" id="addAttrRowBtn" class="button" style="margin-bottom: var(--spacing-md);">‚ûï –î–æ–¥–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç</button>

      <div id="attrRowsContainer"></div>
      
      <div class="actions-container">
        <button id="attrExportBtn" class="button">üì• –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç–∏</button>
        <button id="attrClearBtn" class="clear-btn">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å–µ</button>
      </div>
      
      <div id="attrLog"></div>
    </div>
  </div>

  <!-- –í–±—É–¥–æ–≤–∞–Ω–∏–π —Å–∫—Ä–∏–ø—Ç -->
  <script>
    // ==== –õ–æ–≥—ñ–∫–∞ –¥–ª—è "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤" ====
    let attributeRows = [];
    let lastRowId = 0;

    // –î–æ—Å—Ç—É–ø–Ω—ñ –≥—Ä—É–ø–∏ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    const attributeGroups = [
      {code: 'additionally', name: '–î–æ–¥–∞—Ç–∫–æ–≤–æ'},
      {code: 'display', name: '–î–∏—Å–ø–ª–µ–π'},
      {code: 'params', name: '–ü–∞—Ä–∞–º–µ—Ç—Ä–∏'},
      {code: 'technology_communications', name: '–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —ñ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó'},
      {code: 'main_characteristics', name: '–û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏'},
      {code: 'physical_characteristics', name: '–§—ñ–∑–∏—á–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏'},
      {code: 'ports_connectors', name: '–ü–æ—Ä—Ç–∏ —ñ —Ä–æ–∑\'—î–º–∏'},
      {code: 'power_supply', name: '–ñ–∏–≤–ª–µ–Ω–Ω—è'},
      {code: 'security', name: '–ë–µ–∑–ø–µ–∫–∞'},
      {code: 'other', name: '–Ü–Ω—à–µ'},
      {code: 'cameras', name: '–ö–∞–º–µ—Ä–∏'},
      {code: 'memory', name: '–ü–∞–º\'—è—Ç—å'},
      {code: 'processor', name: '–ü—Ä–æ—Ü–µ—Å–æ—Ä'},
      {code: 'videocard', name: '–í—ñ–¥–µ–æ–∫–∞—Ä—Ç–∞'},
      {code: 'size', name: '–†–æ–∑–º—ñ—Ä–∏'}
    ];

    // –¢–∏–ø–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Å–µ–ª–µ–∫—Ç—É
    const dataTypes = [
      {code: 'pim_catalog_text', name: '–¢–µ–∫—Å—Ç –¥–æ 255 —Å–∏–º–≤–æ–ª—ñ–≤'},
      {code: 'pim_catalog_textarea', name: '–¢–µ–∫—Å—Ç–æ–≤–∞ –æ–±–ª–∞—Å—Ç—å'},
      {code: 'pim_catalog_number', name: '–ß–∏—Å–ª–æ'},
      {code: 'pim_catalog_boolean', name: '–¢–∞–∫/–ù—ñ'},
      {code: 'pim_catalog_multiselect', name: '–ú—É–ª—å—Ç–∏—Å–µ–ª–µ–∫—Ç'},
      {code: 'pim_catalog_simpleselect', name: '–°—ñ–º–ø–ª—Å–µ–ª–µ–∫—Ç'}
    ];

    // –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ä—è–¥–∫–∞ –∑ –∞—Ç—Ä–∏–±—É—Ç–æ–º
    function addAttributeRow(rowData = null) {
      const rowId = lastRowId++;
      const container = document.getElementById('attrRowsContainer');
      
      // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫
      const row = document.createElement('div');
      row.className = 'attr-generator-row';
      row.dataset.id = rowId;
      row.style.position = 'relative';
      
      // –Ü–Ω–¥–µ–∫—Å —Ä—è–¥–∫–∞
      const indexLabel = document.createElement('div');
      indexLabel.className = 'attr-row-index';
      indexLabel.textContent = attributeRows.length + 1;
      row.appendChild(indexLabel);
      
      // –ü–æ–ª–µ –¥–ª—è –∫–æ–¥—É –∞—Ç—Ä–∏–±—É—Ç—É
      const codeField = document.createElement('div');
      codeField.className = 'attr-field';
      
      const codeLabel = document.createElement('label');
      codeLabel.textContent = '–ö–æ–¥ –∞—Ç—Ä–∏–±—É—Ç—É';
      codeLabel.htmlFor = `attrCodeInput${rowId}`;
      
      const codeWrapper = document.createElement('div');
      codeWrapper.className = 'attr-code-wrapper';
      
      const convertBtn = document.createElement('button');
      convertBtn.type = 'button';
      convertBtn.className = 'button convert-btn';
      convertBtn.textContent = 'üîÑ';
      convertBtn.onclick = () => normalizeAttributeCode(rowId);
      
      const codeInput = document.createElement('input');
      codeInput.type = 'text';
      codeInput.id = `attrCodeInput${rowId}`;
      codeInput.placeholder = '–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∞—Ç—Ä–∏–±—É—Ç—É';
      codeInput.value = rowData?.code || '';
      codeInput.oninput = () => validateAttributeCode(rowId);
      
      const codeError = document.createElement('div');
      codeError.className = 'attrCodeError';
      codeError.id = `attrCodeError${rowId}`;
      codeError.textContent = '‚ùå –î–æ–ø—É—Å—Ç–∏–º—ñ —Ç—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏ —Ç–∞ –ø—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–Ω—è.';
      
      codeWrapper.appendChild(convertBtn);
      codeWrapper.appendChild(codeInput);
      
      codeField.appendChild(codeLabel);
      codeField.appendChild(codeWrapper);
      codeField.appendChild(codeError);
      
      // –ü–æ–ª–µ –¥–ª—è –Ω–∞–∑–≤–∏ –∞—Ç—Ä–∏–±—É—Ç—É
      const nameField = document.createElement('div');
      nameField.className = 'attr-field';
      
      const nameLabel = document.createElement('label');
      nameLabel.textContent = '–ù–∞–∑–≤–∞ –∞—Ç—Ä–∏–±—É—Ç—É';
      nameLabel.htmlFor = `attrNameInput${rowId}`;
      
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.id = `attrNameInput${rowId}`;
      nameInput.placeholder = '–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∞—Ç—Ä–∏–±—É—Ç—É';
      nameInput.value = rowData?.name || '';
      nameInput.oninput = () => updateAttributeData(rowId);
      
      nameField.appendChild(nameLabel);
      nameField.appendChild(nameInput);
      
      // –ü–æ–ª–µ –¥–ª—è –≤–∏–±–æ—Ä—É –≥—Ä—É–ø–∏
      const groupField = document.createElement('div');
      groupField.className = 'attr-field';
      
      const groupLabel = document.createElement('label');
      groupLabel.textContent = '–ì—Ä—É–ø–∞';
      groupLabel.htmlFor = `groupSelect${rowId}`;
      
      const groupSelect = document.createElement('select');
      groupSelect.id = `groupSelect${rowId}`;
      groupSelect.onchange = () => updateAttributeData(rowId);
      
      // –î–æ–¥–∞—î–º–æ placeholder –æ–ø—Ü—ñ—é
      const placeholderOption = document.createElement('option');
      placeholderOption.value = '';
      placeholderOption.textContent = '–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É';
      placeholderOption.disabled = true;
      placeholderOption.selected = !rowData?.group;
      groupSelect.appendChild(placeholderOption);
      
      // –î–æ–¥–∞—î–º–æ –æ–ø—Ü—ñ—ó –≥—Ä—É–ø
      attributeGroups.forEach(group => {
        const option = document.createElement('option');
        option.value = group.code;
        option.textContent = group.name;
        if (rowData?.group === group.code) {
          option.selected = true;
        }
        groupSelect.appendChild(option);
      });
      
      groupField.appendChild(groupLabel);
      groupField.appendChild(groupSelect);
      
      // –ü–æ–ª–µ –¥–ª—è –≤–∏–±–æ—Ä—É —Ç–∏–ø—É –¥–∞–Ω–∏—Ö
      const typeField = document.createElement('div');
      typeField.className = 'attr-field';
      
      const typeLabel = document.createElement('label');
      typeLabel.textContent = '–¢–∏–ø –¥–∞–Ω–∏—Ö';
      typeLabel.htmlFor = `typeSelect${rowId}`;
      
      const typeSelect = document.createElement('select');
      typeSelect.id = `typeSelect${rowId}`;
      typeSelect.onchange = () => updateAttributeData(rowId);
      
      // –î–æ–¥–∞—î–º–æ placeholder –æ–ø—Ü—ñ—é
      const typePlaceholder = document.createElement('option');
      typePlaceholder.value = '';
      typePlaceholder.textContent = '–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø';
      typePlaceholder.disabled = true;
      typePlaceholder.selected = !rowData?.dataType;
      typeSelect.appendChild(typePlaceholder);
      
      // –î–æ–¥–∞—î–º–æ –æ–ø—Ü—ñ—ó —Ç–∏–ø—ñ–≤ –¥–∞–Ω–∏—Ö
      dataTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type.code;
        option.textContent = type.name;
        if (rowData?.dataType === type.code) {
          option.selected = true;
        }
        typeSelect.appendChild(option);
      });
      
      typeField.appendChild(typeLabel);
      typeField.appendChild(typeSelect);
      
      // –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
      const deleteBtn = document.createElement('button');
      deleteBtn.type = 'button';
      deleteBtn.className = 'del-btn';
      deleteBtn.textContent = 'üóë';
      deleteBtn.style.height = 'fit-content';
      deleteBtn.style.alignSelf = 'flex-end';
      deleteBtn.onclick = () => deleteAttributeRow(rowId);
      
      // –î–æ–¥–∞—î–º–æ –≤—Å—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤ —Ä—è–¥–æ–∫
      row.appendChild(codeField);
      row.appendChild(nameField);
      row.appendChild(groupField);
      row.appendChild(typeField);
      row.appendChild(deleteBtn);
      
      // –î–æ–¥–∞—î–º–æ —Ä—è–¥–æ–∫ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      container.appendChild(row);
      
      // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –¥–∞–Ω—ñ —Ä—è–¥–∫–∞
      const newRowData = rowData || {
        id: rowId,
        code: '',
        name: '',
        group: '',
        dataType: ''
      };
      
      attributeRows.push(newRowData);
      saveAttributes();
      
      row.classList.add('highlight');
      setTimeout(() => {
        row.classList.remove('highlight');
      }, 1000);
      
      return rowId;
    }

    // –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–¥—É –∞—Ç—Ä–∏–±—É—Ç—É
    function normalizeAttributeCode(rowId) {
      const input = document.getElementById(`attrCodeInput${rowId}`);
      let value = input.value.trim();
      
      if (!value && document.getElementById(`attrNameInput${rowId}`).value) {
        // –Ø–∫—â–æ –∫–æ–¥ –ø–æ—Ä–æ–∂–Ω—ñ–π, –∞–ª–µ —î –Ω–∞–∑–≤–∞, –≥–µ–Ω–µ—Ä—É—î–º–æ –∫–æ–¥ –∑ –Ω–∞–∑–≤–∏
        value = document.getElementById(`attrNameInput${rowId}`).value;
      }
      
      // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è
      input.value = value.toLowerCase()
                        .replace(/[^a-z0-9]+/g, '_')
                        .replace(/_+/g, '_')
                        .replace(/^_|_$/g, '');
      
      validateAttributeCode(rowId);
      updateAttributeData(rowId);
    }

    // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–¥—É –∞—Ç—Ä–∏–±—É—Ç—É
    function validateAttributeCode(rowId) {
      const input = document.getElementById(`attrCodeInput${rowId}`);
      const error = document.getElementById(`attrCodeError${rowId}`);
      const value = input.value;
      
      const isValid = /^[a-z0-9_]*$/.test(value);
      
      if (!isValid) {
        input.classList.add('invalid');
        error.style.display = 'block';
      } else {
        input.classList.remove('invalid');
        error.style.display = 'none';
      }
      
      updateAttributeData(rowId);
      return isValid;
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∞—Ç—Ä–∏–±—É—Ç—É
    function updateAttributeData(rowId) {
      const rowIndex = attributeRows.findIndex(row => row.id === rowId);
      if (rowIndex === -1) return;
      
      attributeRows[rowIndex] = {
        id: rowId,
        code: document.getElementById(`attrCodeInput${rowId}`).value,
        name: document.getElementById(`attrNameInput${rowId}`).value,
        group: document.getElementById(`groupSelect${rowId}`).value,
        dataType: document.getElementById(`typeSelect${rowId}`).value
      };
      
      saveAttributes();
    }

    // –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ä—è–¥–∫–∞ –∞—Ç—Ä–∏–±—É—Ç—É
    function deleteAttributeRow(rowId) {
      const row = document.querySelector(`.attr-generator-row[data-id="${rowId}"]`);
      if (row) {
        row.style.opacity = '0';
        row.style.transform = 'translateX(20px)';
        
        setTimeout(() => {
          row.remove();
          
          // –í–∏–¥–∞–ª—è—î–º–æ –¥–∞–Ω—ñ —Ä—è–¥–∫–∞
          const rowIndex = attributeRows.findIndex(row => row.id === rowId);
          if (rowIndex !== -1) {
            attributeRows.splice(rowIndex, 1);
            saveAttributes();
            updateRowNumbers();
          }
        }, 300);
      }
    }

    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–º–µ—Ä—ñ–≤ —Ä—è–¥–∫—ñ–≤
    function updateRowNumbers() {
      const rows = document.querySelectorAll('.attr-generator-row');
      rows.forEach((row, index) => {
        const indexLabel = row.querySelector('.attr-row-index');
        if (indexLabel) {
          indexLabel.textContent = index + 1;
        }
      });
    }

    // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    function saveAttributes() {
      localStorage.setItem('savedAttributes', JSON.stringify(attributeRows));
    }

    // –ï–∫—Å–ø–æ—Ä—Ç –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –≤ CSV
    function exportAttributes() {
      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ—Ä–æ–∂–Ω—ñ –ø–æ–ª—è
      let hasEmpty = false;
      attributeRows.forEach(row => {
        if (!row.code || !row.name || !row.group || !row.dataType) {
          hasEmpty = true;
        }
      });
      
      if (hasEmpty) {
        if (!confirm('–î–µ—è–∫—ñ —Ä—è–¥–∫–∏ –º–∞—é—Ç—å –Ω–µ–∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –ø–æ–ª—è. –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –µ–∫—Å–ø–æ—Ä—Ç?')) {
          return;
        }
      }
      
      // –§–æ—Ä–º—É—î–º–æ CSV
      const header = ['code', 'label-uk_UA', 'group', 'type'];
      const rows = attributeRows.map(row => [
        row.code, 
        row.name, 
        row.group, 
        row.dataType
      ]);
      
      const csv = [header, ...rows];
      const blob = new Blob([csv.map(r => r.join(';')).join('\n')], {type: 'text/csv;charset=utf-8;'});
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'attributes.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      document.getElementById('attrLog').textContent = `‚úÖ –ï–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ ${rows.length} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ —É CSV.`;
    }

    // –û—á–∏—â–µ–Ω–Ω—è –≤—Å—ñ—Ö –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    function clearAllAttributes() {
      if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∞—Ç—Ä–∏–±—É—Ç–∏?')) {
        return;
      }
      
      document.getElementById('attrRowsContainer').innerHTML = '';
      attributeRows = [];
      // –ù–µ –æ–±–Ω—É–ª—è—î–º–æ lastRowId, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤ —ñ–∑ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏
      localStorage.removeItem('savedAttributes');
      
      document.getElementById('attrLog').textContent = '‚úÖ –í—Å—ñ –∞—Ç—Ä–∏–±—É—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–æ.';
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    function initAttributeGenerator() {
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
      const saved = localStorage.getItem('savedAttributes');
      if (saved) {
        const savedRows = JSON.parse(saved);
        savedRows.forEach(rowData => {
          addAttributeRow(rowData);
        });
        
        // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ lastRowId –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π id + 1
        if (savedRows.length > 0) {
          lastRowId = Math.max(...savedRows.map(row => row.id)) + 1;
        }
      }
      
      // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π
      document.getElementById('addAttrRowBtn').addEventListener('click', () => {
        addAttributeRow();
        document.getElementById('attrLog').textContent = '‚úÖ –î–æ–¥–∞–Ω–æ –Ω–æ–≤–∏–π –∞—Ç—Ä–∏–±—É—Ç.';
      });
      
      document.getElementById('attrExportBtn').addEventListener('click', exportAttributes);
      document.getElementById('attrClearBtn').addEventListener('click', clearAllAttributes);
    }

    // ==== –õ–æ–≥—ñ–∫–∞ –¥–ª—è "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ —Ñ–µ–º—ñ–ª—ñ" ====
    let categories = [];
    let currentIndex = 0;
    let attributeMap = {};

    const requiredCodes = [
      "sku","ean","barcode","article","external_id","code","part_number","name",
      "photo_model_1","photo_1","photo_2","photo_3","photo_4","photo_5","photo_6",
      "photo_7","photo_8","photo_9","description","variation_name","package_height",
      "package_length","package_width","full_weight","country_origin","brand",
      "color","model","series","photo_10","photo_11","photo_12","photo_13",
      "photo_14","photo_15","rating","vendor_code","partner_name","offer",
      "keywords","product_status"
    ];

    function normalize(str) {
      if (!str) return '';
      return str.toLowerCase()
        .replace(/[\s'',-]+/g,'_')
        .replace(/[^a-z0-9_]/g,'')
        .trim();
    }

    // Fix for Bug 1: Improved the autoGrow function
    function autoGrow(textarea) {
      // Store the current scroll position
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      // Reset the height to a small value first
      textarea.style.height = "auto";
      
      // Set the height based on scrollHeight (with a max height if needed)
      const maxHeight = 300; // maximum height in pixels
      const newHeight = Math.min(textarea.scrollHeight, maxHeight);
      textarea.style.height = newHeight + "px";
      
      // If the textarea exceeds max height, make it scrollable
      if (textarea.scrollHeight > maxHeight) {
        textarea.style.overflowY = "auto";
      } else {
        textarea.style.overflowY = "hidden";
      }
      
      // Restore the scroll position to prevent page jumping
      window.scrollTo(0, scrollTop);
    }

    function updateUI() {
      const cat = categories[currentIndex] || {};
      document.getElementById('codeInput').value = cat.code || "";
      document.getElementById('labelInput').value = cat.label || "";
      const attrsTextarea = document.getElementById('attrsInput');
      attrsTextarea.value = cat.attrs || "";
      // Apply the autoGrow with a slight delay to ensure DOM is updated
      setTimeout(() => autoGrow(attrsTextarea), 10);
      document.getElementById('catIndicator').textContent = `–ö–∞—Ç–µ–≥–æ—Ä—ñ—è ${currentIndex+1} / ${categories.length}`;
    }

    function saveCurrentCategory() {
      const codeField = document.getElementById('codeInput');
      codeField.value = normalize(codeField.value);
      categories[currentIndex] = {
        code: codeField.value,
        label: document.getElementById('labelInput').value.trim(),
        attrs: document.getElementById('attrsInput').value.trim()
      };
      localStorage.setItem('savedCategories', JSON.stringify(categories));
    }

    function validateCode() {
      const value = document.getElementById('codeInput').value;
      const isValid = /^[a-zA-Z0-9_]*$/.test(value);
      document.getElementById('codeError').style.display = isValid ? 'none' : 'block';
      return isValid;
    }

    function convertCode() {
      const codeField = document.getElementById('codeInput');
      codeField.value = normalize(codeField.value);
      validateCode();
    }

    function addCategory() {
      saveCurrentCategory();
      categories.push({code:"", label:"", attrs:""});
      currentIndex = categories.length - 1;
      updateUI();
      document.getElementById('log').textContent = "‚úÖ –ù–æ–≤—É –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –¥–æ–¥–∞–Ω–æ.";
    }

    function deleteCurrentCategory() {
      if (categories.length <= 1) {
        alert("–ú–∞—î –±—É—Ç–∏ —Ö–æ—á–∞ –± –æ–¥–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è.");
        return;
      }
      
      categories.splice(currentIndex, 1);
      currentIndex = Math.max(0, currentIndex - 1);
      updateUI();
      localStorage.setItem('savedCategories', JSON.stringify(categories));
      document.getElementById('log').textContent = "‚úÖ –ö–∞—Ç–µ–≥–æ—Ä—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ.";
    }

    function prevCategory() {
      saveCurrentCategory();
      if (currentIndex > 0) {
        currentIndex--;
        updateUI();
      }
    }

    function nextCategory() {
      saveCurrentCategory();
      if (currentIndex < categories.length - 1) {
        currentIndex++;
        updateUI();
      }
    }

    function clearFields() {
      document.getElementById('codeInput').value = "";
      document.getElementById('labelInput').value = "";
      document.getElementById('attrsInput').value = "";
      categories[currentIndex] = {code:"", label:"", attrs:""};
      localStorage.setItem('savedCategories', JSON.stringify(categories));
      document.getElementById('log').textContent = "‚úÖ –ü–æ–ª—è –æ—á–∏—â–µ–Ω–æ.";
    }

    function clearAll() {
      if (!confirm("–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó?")) return;
      
      categories = [{code:"", label:"", attrs:""}];
      currentIndex = 0;
      localStorage.removeItem('savedCategories');
      updateUI();
      document.getElementById('previewBox').innerHTML = "–ù–∞—Ä–∞–∑—ñ –ø–æ—Ä–æ–∂–Ω—å–æ...";
      document.getElementById('log').textContent = "‚úÖ –í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó –æ—á–∏—â–µ–Ω–æ.";
      attributeMap = {};
      document.getElementById('fileStatus').textContent = "üõë –§–∞–π–ª –Ω–µ –¥–æ–¥–∞–Ω–æ";
      document.getElementById('attributeFile').value = "";
      document.querySelectorAll('.dependent').forEach(el => el.disabled = true);
    }

    function normalizeAttributeText(text) {
      if (!text) return "";
      return text.replace(/^["']|["']$/g, "").trim().toLowerCase().replace(/\s+/g, " ");
    }

    function generateCSV() {
      saveCurrentCategory();
      
      // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö
      let hasErrors = false;
      for (let i = 0; i < categories.length; i++) {
        const cat = categories[i];
        if (!cat.code || !cat.label) {
          alert(`–ö–∞—Ç–µ–≥–æ—Ä—ñ—è #${i+1} –º–∞—î –ø–æ—Ä–æ–∂–Ω—ñ–π –∫–æ–¥ –∞–±–æ –Ω–∞–∑–≤—É.`);
          hasErrors = true;
          break;
        }
      }
      
      if (hasErrors) return;
      
      const rows = [];
      let warningMessages = [];
      
      for (const cat of categories) {
        const rawAttributes = cat.attrs.split(/[\n,]+/).map(s => normalizeAttributeText(s)).filter(Boolean);
        const attributeCodes = [];
        const missingAttributes = [];
        
        for (const attrLabel of rawAttributes) {
          if (attributeMap[attrLabel]) {
            attributeCodes.push(attributeMap[attrLabel]);
          } else {
            missingAttributes.push(attrLabel);
          }
        }
        
        if (missingAttributes.length) {
          warningMessages.push(`–£ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó "${cat.label || cat.code}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞—Ç—Ä–∏–±—É—Ç–∏: ${missingAttributes.join(', ')}`);
        }
        
        const allAttributes = Array.from(new Set([...requiredCodes, ...attributeCodes]));
        rows.push([cat.code, cat.label, allAttributes.join(','), "photo_1", "name"]);
      }
      
      if (warningMessages.length) {
        const proceed = confirm(warningMessages.join('\n\n') + "\n\n–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?");
        if (!proceed) return;
      }
      
      const csv = [["code", "label-uk_UA", "attributes", "attribute_as_image", "attribute_as_label"], ...rows];
      const blob = new Blob([csv.map(r => r.join(";")).join("\n")], {type: 'text/csv;charset=utf-8;'});
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "categories.csv";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      document.getElementById('log').textContent = "‚úÖ CSV —Ñ–∞–π–ª –∑–±–µ—Ä–µ–∂–µ–Ω–æ.";
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤ º—é
      const table = document.createElement("table");
      const [header, ...body] = csv;
      
      const thead = table.createTHead().insertRow();
      header.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col;
        thead.appendChild(th);
      });
      
      const tbody = table.createTBody();
      body.forEach(row => {
        const tr = tbody.insertRow();
        row.forEach(cell => {
          const td = tr.insertCell();
          td.textContent = cell;
        });
      });
      
      document.getElementById('previewBox').innerHTML = "";
      document.getElementById('previewBox').appendChild(table);
      
      // –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤ º—é
      document.getElementById('previewContainer').style.display = "block";
    }

    function togglePreview() {
      const previewContainer = document.getElementById('previewContainer');
      previewContainer.style.display = (previewContainer.style.display === "" || previewContainer.style.display === "none") ? "block" : "none";
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è CSV —Ñ–∞–π–ª—É –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
    document.getElementById('attributeFile').addEventListener('change', event => {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = e => {
        const content = e.target.result;
        const lines = content.split('\n');
        
        if (lines.length < 2) {
          alert("–§–∞–π–ª –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ –º–∞—î –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç.");
          return;
        }
        
        const header = lines[0];
        // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫ - –∫—Ä–∞–ø–∫–∞ –∑ –∫–æ–º–æ—é –∞–±–æ –∫–æ–º–∞
        const delimiter = header.split(';').length >= header.split(',').length ? ';' : ',';
        const columns = header.split(delimiter);
        
        const codeIndex = columns.indexOf('code');
        const labelIndex = columns.indexOf('label-uk_UA');
        
        if (codeIndex === -1 || labelIndex === -1) {
          alert("–£ —Ñ–∞–π–ª—ñ –≤—ñ–¥—Å—É—Ç–Ω—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –∫–æ–ª–æ–Ω–∫–∏ 'code' –∞–±–æ 'label-uk_UA'.");
          return;
        }
        
        attributeMap = {};
        let processedCount = 0;
        
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].replace(/\r/g, '');
          if (!line.trim()) continue; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ —Ä—è–¥–∫–∏
          
          const row = line.split(delimiter);
          if (row.length > Math.max(codeIndex, labelIndex)) {
            const label = normalizeAttributeText(row[labelIndex]);
            const code = row[codeIndex]?.trim() || "";
            
            if (label && code) {
              attributeMap[label] = code;
              processedCount++;
            }
          }
        }
        
        document.getElementById('fileStatus').textContent = `‚úÖ –§–∞–π–ª –¥–æ–¥–∞–Ω–æ (${processedCount} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤)`;
        document.getElementById('log').textContent = `‚úÖ –§–∞–π–ª –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –ó–Ω–∞–π–¥–µ–Ω–æ ${processedCount} –∞—Ç—Ä–∏–±—É—Ç—ñ–≤.`;
        document.querySelectorAll('.dependent').forEach(el => el.disabled = false);
      };
      
      reader.onerror = () => {
        alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —á–∏—Ç–∞–Ω–Ω—ñ —Ñ–∞–π–ª—É.");
      };
      
      reader.readAsText(file);
    });

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
    window.addEventListener('DOMContentLoaded', () => {
      // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ç–∞–±—ñ–≤
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab).classList.add('active');
        });
      });
      
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
      const saved = localStorage.getItem('savedCategories');
      categories = saved ? JSON.parse(saved) : [{code:"", label:"", attrs:""}];
      updateUI();
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤
      initAttributeGenerator();
      
      // –î–æ–¥–∞—î–º–æ —Å–ª—É—Ö–∞—á—ñ –ø–æ–¥—ñ–π –¥–ª—è –≤—Å—ñ—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ –≤ –∞—Ç—Ä–∏–±—É—Ç–∞—Ö
      document.getElementById('attrsInput').addEventListener('input', function() {
        autoGrow(this);
      });
    });
  </script>
</body>
</html>
